!-----------------------------------------------------------------------------
! (c) Crown copyright 2025 Met Office. All rights reserved.
! The file LICENCE, distributed with this code, contains details of the terms
! under which the code may be used.
!-----------------------------------------------------------------------------
!> @brief  Test the functionality of swift_inner_update_kernel_mod

module swift_inner_update_kernel_mod_test

  use constants_mod, only: i_def, r_tran, r_def
  use funit

  implicit none

  private
  public :: test_all

contains

  !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
  @Test
  subroutine test_all( )

    use swift_inner_update_kernel_mod, only: swift_inner_update_code

    implicit none

    real(kind=r_tran), parameter :: tol = 1.0e-12_r_tran

    real(kind=r_tran) :: field_np1
    real(kind=r_tran), parameter :: field_n = 589.4623_r_tran
    real(kind=r_tran), parameter :: dry_mass_np1 = 7.531_r_tran
    real(kind=r_tran), parameter :: dry_mass_n = 5.3891_r_tran
    real(kind=r_tran), parameter :: increment = 34.8094623_r_tran
    real(kind=r_tran), parameter :: dt = 531.89523_r_tran
    real(kind=r_tran) :: answer

    field_np1 = 1.56234_r_tran

    !answer = (field_n*dry_mass_n - dt*increment)/dry_mass_np1
    answer = -2036.6904362375287_r_tran

    call swift_inner_update_code(field_np1,    &
                                 field_n,      &
                                 dry_mass_np1, &
                                 dry_mass_n,   &
                                 increment,    &
                                 dt)

    @assertEqual(answer, field_np1, tol)

  end subroutine test_all

end module swift_inner_update_kernel_mod_test
