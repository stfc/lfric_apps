# Please see jules:wiki:SharingJULESmetadata

import=lfric-jules-shared/jules-hydrology/HEAD
      =lfric-jules-shared/jules-nvegparm/HEAD
      =lfric-jules-shared/jules-pftparm/HEAD
      =lfric-jules-shared/jules-radiation/HEAD
      =lfric-jules-shared/jules-sea-seaice/HEAD
      =lfric-jules-shared/jules-snow/HEAD
      =lfric-jules-shared/jules-soil/HEAD
      =lfric-jules-shared/jules-surface/HEAD
      =lfric-jules-shared/jules-surface-types/HEAD
      =lfric-jules-shared/jules-urban/HEAD
      =lfric-jules-shared/jules-vegetation/HEAD

[namelist:ideal_surface]
compulsory=true
description=Idealised surface settings
ns=namelist/Job/Initial conditions/Surface
sort-key=Section-A05
title=Surface

[namelist:ideal_surface=canopy_height]
compulsory=true
description=Canopy height of each plant type
fail-if=len(this) != namelist:jules_surface_types=npft
help=Canopy height of each plant type
!kind=default
length=:
ns=namelist/Job/Initial conditions/Surface
sort-key=Panel-03
type=real

[namelist:ideal_surface=leaf_area_index]
compulsory=true
description=Leaf area index of each plant type
fail-if=len(this) != namelist:jules_surface_types=npft
help=Leaf area index of each plant type
!kind=default
length=:
ns=namelist/Job/Initial conditions/Surface
sort-key=Panel-04
type=real

[namelist:ideal_surface=n_snow_layers]
compulsory=true
description=Snow layers on each tile
fail-if=len(this) != namelist:jules_surface_types=npft + namelist:jules_surface_types=nnvg + namelist:jules_sea_seaice=nice + 1
help=The initial number of snow layers on each surface tile
    =
    =The order of tiles is land, sea, sea-ice
!kind=default
length=:
ns=namelist/Job/Initial conditions/Surface
sort-key=Panel-08
type=integer

[namelist:ideal_surface=snow_depth]
compulsory=true
description=Snow depth on each tile
fail-if=len(this) != namelist:jules_surface_types=npft + namelist:jules_surface_types=nnvg + namelist:jules_sea_seaice=nice + 1
help=The initial snow depth on each surface tile
    =
    =The order of tiles is land, sea, sea-ice
!kind=default
length=:
ns=namelist/Job/Initial conditions/Surface
sort-key=Panel-09
type=real

[namelist:ideal_surface=snow_layer_ice_mass]
compulsory=true
description=Ice mass of each snow layer on tiles
fail-if=len(this) != 3*(namelist:jules_surface_types=npft + namelist:jules_surface_types=nnvg)
help=The initial ice mass of each snow layer
    =
    =The order in tiles 1-n for layer 1, then tiles 1-n for layer 2 etc
!kind=default
length=:
ns=namelist/Job/Initial conditions/Surface
sort-key=Panel-11
type=real

[namelist:ideal_surface=snow_layer_temp]
compulsory=true
description=Temperature of each snow layer on tiles
fail-if=len(this) != 3*(namelist:jules_surface_types=npft + namelist:jules_surface_types=nnvg)
help=The initial temperature of each snow layer
    =
    =The order in tiles 1-n for layer 1, then tiles 1-n for layer 2 etc
!kind=default
length=:
ns=namelist/Job/Initial conditions/Surface
sort-key=Panel-12
type=real

[namelist:ideal_surface=snow_layer_thickness]
compulsory=true
description=Thickness of each snow layer on tiles
fail-if=len(this) != 3*(namelist:jules_surface_types=npft + namelist:jules_surface_types=nnvg)
help=The initial thickness of each snow layer
    =
    =The order in tiles 1-n for layer 1, then tiles 1-n for layer 2 etc
!kind=default
length=:
ns=namelist/Job/Initial conditions/Surface
sort-key=Panel-10
type=real

[namelist:ideal_surface=soil_moisture]
compulsory=true
description=Soil moisture content
help=Soil moisture content on soil levels
!kind=default
length=4
ns=namelist/Job/Initial conditions/Surface
sort-key=Panel-05
type=real

[namelist:ideal_surface=soil_temperature]
compulsory=true
description=Soil temperature
help=Temperature of soil levels
!kind=default
length=4
ns=namelist/Job/Initial conditions/Surface
sort-key=Panel-06
type=real

[namelist:ideal_surface=surf_tile_fracs]
compulsory=true
description=Fraction of each surface tile
fail-if=len(this) != namelist:jules_surface_types=npft + namelist:jules_surface_types=nnvg + namelist:jules_sea_seaice=nice + 1
help=The fraction within a grid-box of each surface tile
    =
    =The order of tiles is land, sea, sea-ice
    =
    =The fractions should sum to 1
!kind=default
length=:
ns=namelist/Job/Initial conditions/Surface
sort-key=Panel-01
type=real

[namelist:ideal_surface=surf_tile_temps]
compulsory=true
description=Fraction of each surface tile
fail-if=len(this) != namelist:jules_surface_types=npft + namelist:jules_surface_types=nnvg + namelist:jules_sea_seaice=nice + 1
help=The initial temperature of each surface tile
    =
    =The order of tiles is land, sea, sea-ice
!kind=default
length=:
ns=namelist/Job/Initial conditions/Surface
sort-key=Panel-02
type=real

[namelist:ideal_surface=tile_snow_mass]
compulsory=true
description=Snow mass on each tile
fail-if=len(this) != namelist:jules_surface_types=npft + namelist:jules_surface_types=nnvg + namelist:jules_sea_seaice=nice + 1
help=The initial snow mass on each surface tile
    =
    =The order of tiles is land, sea, sea-ice
!kind=default
length=:
ns=namelist/Job/Initial conditions/Surface
sort-key=Panel-07
type=real

[namelist:jules_hydrology=l_hydrology]
trigger=namelist:jules_hydrology=l_var_rainfrac: .true.;

[namelist:jules_radiation=fixed_sea_albedo]
description=If using i_sea_alb_method='fixed', the global value of albedo to use.

[namelist:jules_radiation=i_sea_alb_method]
trigger=namelist:jules_radiation=l_sea_alb_var_chl: 'jin';
       =namelist:jules_radiation=fixed_sea_albedo: 'fixed';
value-titles=Barker and Li 1995,Jin et al. 2011,Fixed global value
values='barker','jin','fixed'

[namelist:jules_radiation=l_albedo_obs]
trigger=namelist:files=albedo_vis_ancil_path: .true. ;
       =namelist:files=albedo_nir_ancil_path: .true. ;
       =namelist:jules_nvegparm=albsnf_nvgu_io: .true.;
       =namelist:jules_nvegparm=albsnf_nvgl_io: .true.;

[namelist:jules_radiation=l_sea_alb_var_chl]
trigger=namelist:files=sea_ancil_path: .true. ;

[namelist:jules_snow=can_clump]
fail-if=len(this) != namelist:jules_surface_types=npft; # A value must be given for each PFT
       =all(this == 0) and any(namelist:jules_snow=cansnowpft ==  '.true.'); # Results in floating point exception if 0. Only used if can_model = 4 (JULES default), cansnowpft = TRUE on that tile and l_embedded_snow = TRUE (LFRic default).

[namelist:jules_snow=cansnowpft]
compulsory=true
length=5

[namelist:jules_snow=i_basal_melting_opt]
values='none','instant'

[namelist:jules_snow=i_grain_growth_opt]
values='marshall','taillandier'

[namelist:jules_snow=i_relayer_opt]
values='original','inverse'

[namelist:jules_surface=cor_mo_iter]
value-titles=Limit Obukhov length in low winds,
            =Improve initial guess (preferred)
values='lim_oblen','improved'

[namelist:jules_surface=fd_stability_dep]
value-titles=Off,Surface Ri
values='none','surf_ri'

[namelist:jules_surface=formdrag]
trigger=namelist:jules_surface=fd_stability_dep: 'eff_z0','dist_drag';
values='none','eff_z0','dist_drag'

[namelist:jules_surface=l_urban2t]
trigger=namelist:jules_surface_types=urban_canyon: .true.;
       =namelist:jules_surface_types=urban_roof: .true.;
       =namelist:jules_surface_types=urban: .false.;
       =namelist:jules_urban: .true.;
       =namelist:jules_urban=anthrop_heat_scale: .true.;
       =namelist:files=urban_ancil_path: .true.;
       =namelist:stochastic_physics=rp_lsfc_z0_urban_mult: .true. ;

[namelist:jules_surface=l_vary_z0m_soil]
trigger=namelist:files=soil_rough_ancil_path: .true. ;

[namelist:jules_surface=srf_ex_cnv_gust]
type=logical

[namelist:jules_vegetation=can_rad_mod]
values='one','four','five','six'

[namelist:jules_vegetation=l_spec_veg_z0]
trigger=namelist:jules_pftparm=z0v_io: .true.;
       =namelist:stochastic_physics=rp_lsfc_z0v: .true.;
       =namelist:stochastic_physics=rp_lsfc_z0v_max: .true.;
       =namelist:stochastic_physics=rp_lsfc_z0v_min: .true.;

[namelist:specified_surface]
compulsory=true
description=Further Idealised surface settings
ns=namelist/Science/Specified Surface
sort-key=Section-A05
title=Specified Surface

[namelist:specified_surface=function_amplitude_e]
compulsory=true
description=Amplitude of the function used for surface latent heat flux
help=Specifies the amplitude of the analytical function used for calculating the
    =surface latent heat flux
!kind=default
ns=namelist/Science/Specified Surface
sort-key=Panel-A03
type=real

[namelist:specified_surface=function_amplitude_h]
compulsory=true
description=Amplitude of the function used for surface sensible heat flux
help=Specifies the amplitude of the analytical function used for calculating the
    =surface sensible heat flux
!kind=default
ns=namelist/Science/Specified Surface
sort-key=Panel-A03
type=real

[namelist:specified_surface=function_name_fluxes]
compulsory=true
description=Name of the function used for surface latent and sensible heat fluxes
!enumeration=true
help=Specifies function name used for calculating surface latent and sensible heat fluxes
    =If constant, uses the single values set in specified_flux_h and specified_flux_e. profile_size should be set to 1.
    =If time-interpolated, uses the time-varying arrays set in specified_flux_h and specified_flux_e, where the arrays are of length profile_size.
    =If sinusoidal, fluxes are set to
    =amplitude * sin( 2 * pi * current_time / period + phase )
    =If diurnal, fluxes are set to
    =max(0, amplitude * cos( pi* (time_of_max_flux - current_time) / length_of_day )^1.3 )
!kind=default
ns=namelist/Science/Specified Surface
sort-key=Panel-A03
trigger=namelist:specified_surface=function_amplitude_e: 'sinusoidal', 'diurnal';
       =namelist:specified_surface=function_period_e: 'sinusoidal';
       =namelist:specified_surface=function_phase_e: 'sinusoidal';
       =namelist:specified_surface=function_amplitude_h: 'sinusoidal', 'diurnal';
       =namelist:specified_surface=function_period_h: 'sinusoidal';
       =namelist:specified_surface=function_phase_h: 'sinusoidal';
       =namelist:specified_surface=length_of_day: 'diurnal';
       =namelist:specified_surface=time_of_max_flux: 'diurnal';
       =namelist:specified_surface=length_of_day: 'diurnal';
       =namelist:specified_surface=time_data: 'time_interpolated';
       =namelist:specified_surface=profile_size: 'constant','time_interpolated';
       =namelist:specified_surface=specified_flux_e: 'constant','time_interpolated';
       =namelist:specified_surface=specified_flux_h: 'constant','time_interpolated';
       =namelist:specified_surface=time_units: 'sinusoidal', 'diurnal', 'time_interpolated';
value-titles=Constant, Time Interpolated, Sinusoidal function, Diurnal function
values='constant', 'time_interpolated', 'sinusoidal', 'diurnal'

[namelist:specified_surface=function_name_sst]
compulsory=true
description=Name of the function used for sea surface temperatures
!enumeration=true
help=Specifies the function name used for calculating surface sensible heat flux
    = If constant, uses the sea surface tile value set by surf_tile_temps option found in
    = ideal_surface namelist.
    = If time_interpolated, uses the time-varying array set in sea_surf_temps found in the
    = specified_surface namelist.
!kind=default
ns=namelist/Science/Specified Surface
sort-key=Panel-A03
trigger=namelist:specified_surface=time_data_sst: 'time_interpolated';
       =namelist:specified_surface=profile_size_sst: 'time_interpolated';
       =namelist:specified_surface=time_units_sst: 'time_interpolated';
       =namelist:specified_surface=sea_surf_temps: 'time_interpolated';
value-titles=Constant, Time Interpolated
values='constant', 'time_interpolated'

[namelist:specified_surface=function_period_e]
compulsory=true
description=Period of the function used for surface latent heat flux
help=Specifies the period of the sinusoidal analytical function used for calculating
    =latent heat flux
!kind=default
ns=namelist/Science/Specified Surface
sort-key=Panel-A03
type=real

[namelist:specified_surface=function_period_h]
compulsory=true
description=Period of the function used for surface sensible heat flux
help=Specifies the period of the sinusoidal analytical function used for calculating
    =sensible heat flux
!kind=default
ns=namelist/Science/Specified Surface
sort-key=Panel-A03
type=real

[namelist:specified_surface=function_phase_e]
compulsory=true
description=Phase of the function used for latent heat flux
help=Specifies the phase of the sinusoidal analytical function used for calculating the
    =latent heat flux
!kind=default
ns=namelist/Science/Specified Surface
sort-key=Panel-A03
type=real

[namelist:specified_surface=function_phase_h]
compulsory=true
description=Phase of the function used for sensible heat flux
help=Specifies the phase of the sinusoidal analytical function used for calculating the
    =sensible heat flux
!kind=default
ns=namelist/Science/Specified Surface
sort-key=Panel-A03
type=real

[namelist:specified_surface=internal_flux_method]
compulsory=true
description=How to prescribe the internal flux
!enumeration=true
help=Either a constant value or a 2D map
!kind=default
ns=namelist/Science/Specified Surface
sort-key=Panel-A03
trigger=namelist:files=internal_flux_ancil_path: 'non_uniform' ;
       =namelist:specified_surface=internal_flux_value: 'uniform' ;
value-titles=Uniform, Non-Uniform
values='uniform','non_uniform'

[namelist:specified_surface=internal_flux_value]
compulsory=true
description=Constant internal flux value
help=Use the Stefan-Boltzmann law to calculate the flux from
    =internal temperature T_int
!kind=default
ns=namelist/Science/Specified Surface
sort-key=Panel-A03
type=real

[namelist:specified_surface=length_of_day]
compulsory=true
description=Duration of daylight
help=Specifies the duration of daylight, in units that are consistent with
    =the length_of_day option, used for the diurnal analytical function.
!kind=default
ns=namelist/Science/Specified Surface
sort-key=Panel-A03
type=real

[namelist:specified_surface=profile_size]
compulsory=true
description=Number of points in varying flux profile
help=Number of data points in the specified_flux_h and specified_flux_e
    =arrays
!kind=default
ns=namelist/Science/Specified Surface
range=0:
sort-key=Panel-A03e
type=integer

[namelist:specified_surface=profile_size_sst]
compulsory=true
description=Number of points in sst profile
help=Number of data points in the sea_surf_temps arrays
!kind=default
ns=namelist/Science/Specified Surface
range=0:
sort-key=Panel-A03e
type=integer

[namelist:specified_surface=sea_surf_temps]
!bounds=namelist:specified_surface=profile_size_sst
compulsory=true
description=Time-varying sea surface temperature profile
help=Sea surface temperature values (K) used at times specified, overides
    =the sea surface tile value set by surf_tile_temps option found in
    =ideal_surface namelist.
!kind=default
length=:
ns=namelist/Science/Specified Surface
sort-key=Panel-A03d
type=real

[namelist:specified_surface=specified_flux_e]
!bounds=namelist:specified_surface=profile_size
compulsory=true
description=Surface latent heat flux [Wm-2]
help=Fixed or time-varying value used throughout the run.
!kind=default
length=:
ns=namelist/Science/Specified Surface
sort-key=Panel-A01a
type=real

[namelist:specified_surface=specified_flux_h]
!bounds=namelist:specified_surface=profile_size
compulsory=true
description=Surface sensible heat flux [Wm-2]
help=Fixed or time-varying value used throughout the run
!kind=default
length=:
ns=namelist/Science/Specified Surface
sort-key=Panel-A01b
type=real

[namelist:specified_surface=surf_temp_forcing]
compulsory=true
description=Forcing of the surface temperature
!enumeration=true
help=E.g. increment due to an internal flux
!kind=default
ns=namelist/Science/Specified Surface
sort-key=Panel-A03
trigger=namelist:specified_surface=internal_flux_method: 'int_flux' ;
value-titles=None, Internal flux
values='none','int_flux'

[namelist:specified_surface=time_data]
!bounds=namelist:specified_surface=profile_size
compulsory=true
description=Time values
help=Time values corresponding with the time-varying fluxes
!kind=default
length=:
ns=namelist/Science/Specified Surface
range=0.0:
sort-key=Panel-A03c
type=real

[namelist:specified_surface=time_data_sst]
!bounds=namelist:specified_surface=profile_size_sst
compulsory=true
description=Time values
help=Time values corresponding with the time-varying ssts
!kind=default
length=:
ns=namelist/Science/Specified Surface
range=0.0:
sort-key=Panel-A03c
type=real

[namelist:specified_surface=time_of_max_flux]
compulsory=true
description=Time of maximum flux
help=Specifies the time of day when the flux reaches its maximum value.
    =The units must be consistent with the units used by the length_of_day option.
    =Used for the diurnal analytical function.
!kind=default
ns=namelist/Science/Specified Surface
sort-key=Panel-A03
type=real

[namelist:specified_surface=time_units]
compulsory=true
description=Units of the time_data list/ function_period
!enumeration=true
help=Specifies the units of the time data/ wave period used.
ns=namelist/Science/Specified Surface
value-titles=Seconds,Minutes,Hours,Days
values='seconds','minutes','hours','days'

[namelist:specified_surface=time_units_sst]
compulsory=true
description=Units of the time_data list/ function_period
!enumeration=true
help=Specifies the units of the time data/ wave period used.
ns=namelist/Science/Specified Surface
value-titles=Seconds,Minutes,Hours,Days
values='seconds','minutes','hours','days'

[namelist:surface]
compulsory=true
description=Surface parametrisations used in the surface interface
ns=namelist/Science/Surface Interface
sort-key=Section-A12

[namelist:surface=check_soilm_negatives]
description=Switch to check if soil moisture has become negative as part of the
           =lake water conservation scheme
ns=namelist/Science/Surface Interface/Soil
sort-key=Panel-B01a
type=logical

[namelist:surface=emis_method_sea]
compulsory=true
description=Emissivity method for open sea
           = Two options for spectrally varying emissivity in addition to a fixed emissivity:
           = D. Feldman et al. (2014) https://doi.org/10.1073/pnas.1413640111 and
           = R. Saunders et al. (2018) https://doi.org/10.5194/gmd-11-2717-2018 for IREMIS.
!enumeration=true
ns=namelist/Science/Surface Interface/Radiation
value-titles=1: Fixed,
            =2: Feldman,
            =3: IREMIS
values='fixed','feldman','iremis'

[namelist:surface=emis_method_soil]
compulsory=true
description=Emissivity method for soil
           = Option for spectrally varying emissivity in addition to a fixed emissivity:
           = D. Feldman et al. (2014) https://doi.org/10.1073/pnas.1413640111
!enumeration=true
ns=namelist/Science/Surface Interface/Radiation
value-titles=1: Fixed,
            =2: Feldman Desert
values='fixed','feldman_desert'

[namelist:surface=lake_water_conservation]
compulsory=true
description=Use the lake water conservation scheme
help=The inland water tile (aka lake tile) is a freely evaporating surface that does not deplete the local water supply. In order to conserve water the lake water conservation scheme decreases the level 4 soil moisture globally to account for this.
ns=namelist/Science/Surface Interface/Soil
sort-key=Panel-B01
trigger=namelist:surface=check_soilm_negatives: .true.;
type=logical

# Dummy page to force sort order for JULES Science Settings
[namespace:science]
ns=namelist/JULES Science Settings
sort-key=Section-A12b

# Dummy page to force sort order for Snow other parameters
[namespace:snow_other]
ns=namelist/JULES Science Settings/jules_snow/Other parameters
sort-key=02

# Dummy page to force sort order for Snow radiation parameters
[namespace:snow_radiation]
ns=namelist/JULES Science Settings/jules_snow/Radiation parameters
sort-key=01

# Dummy page to force sort order for JULES Surface Types
[namespace:surface_types]
ns=namelist/JULES Surface Types
sort-key=Section-A12a
