#==============================================================================
# CLOUD:
#==============================================================================

[namelist:cloud]
compulsory=true
description=Cloud parametrization
ns=namelist/Science/UM Cloud
sort-key=Section-A05
title=Cloud

[namelist:cloud=cff_spread_rate]
compulsory=true
description=Ice cloud fraction spreading rate
help=When the effects of shear on falling ice cloud are either ignored
    = or derived from model winds,
    =this controls the rate at which ice
    = cloud fraction spreads.
!kind=default
ns=namelist/Science/UM Cloud
range=0.0:1.0e-1
sort-key=Panel-A04a
type=real

[namelist:cloud=cld_fsd_hill]
compulsory=true
description=Whether to use the Hill scheme for fractional standard deviation of condensate
help=If true:  uses the Hill et al (2015) parametrization of fractional standard deviation
    =          (FSD) of cloud condensate in both the microphysics and the radiation schemes.
    =If false: uses the Boutle et al (2014) scheme for fractional standard deviation in the
    =          the microphysics and a time-and-space invariant value for radiation.
!kind=default
ns=namelist/Science/UM Cloud
sort-key=Panel-A06
trigger=namelist:cloud=cloud_horizontal_fsd: .false.
type=logical

[namelist:cloud=cloud_call_b4_conv]
compulsory=true
description=Extra call to the large-scale-cloud scheme before convection
help=Switch to perform an extra call to the large-scale cloud scheme before the
    = call to convection in atmos_physics2, to ensure the latest T,q,qcl,cf
    = seen by convection are consistent with the cloud scheme assumptions.
    = For PC2, this entails an extra call to PC2 checks and PC2 initiation
    = before convection, and the application of advective pressure forcing
    = which in the UM is controlled by the switch l_pc2_sl_advection.
    = For diagnostic cloud schemes, this only updates the "latest" cloud
    = fraction fields passed into convection; the primary fields for the cloud
    = fractions are still calculated in ni_imp_ctl as usual.
!kind=default
ns=namelist/Science/UM Cloud
sort-key=Panel-A12
type=logical

[namelist:cloud=cloud_horizontal_fsd]
compulsory=true
description=Relative standard deviation of cloud condensate
help=Defines the sub-grid cloud horizontal inhomogeneity using a single
    =global value of the cloud condensate relative standard deviation
    =(standard deviation / mean).
!kind=default
ns=namelist/Science/UM Cloud
sort-key=Panel-A07
type=real

[namelist:cloud=cloud_pc2_tol]
compulsory=true
description=PC2 threshold liquid cloud fraction to retain cloud (RH < RHcrit)
help=When RH is below RHcrit, instances of liquid-cloud fraction below
    =cloud_pc2_tol are reset to zero at the end of each timestep.
    =Also instances of liquid-cloud fraction above 1 - cloud_pc2_tol
    =are reset to 1.
    =This threshold is also used to determine when to initiate cloud
    =from clear-sky (or holes in cloud from fully overcast)
    =under the "simplified" PC2 initiation logic option (i_pc2_init_logic=2).
    =
    =Note that pc2_checks performs an independent additional check to remove
    =liquid-cloud fractions below cloud_rounding_tol = 1.0E-12.
!kind=default
ns=namelist/Science/UM Cloud
range=1.0e-12:1.0e-1
sort-key=Panel-A02b
type=real

[namelist:cloud=cloud_pc2_tol_2]
compulsory=true
description=PC2 threshold liquid cloud fraction to retain cloud (RH > RHcrit)
fail-if=this > namelist:cloud=cloud_pc2_tol
help=When RH is above RHcrit, instances of liquid-cloud fraction below
    =cloud_pc2_tol_2 are reset to zero at the end of each timestep.
    =Also instances of liquid-cloud fraction above 1 - cloud_pc2_tol_2
    =are reset to 1.
    =This threshold is also used in a couple other places:
    = - Optical depth filtered cloud diagnostics are set to zero where
    =   the combined cloud fraction (stratiform + convective)
    =   is below the threshold.
    = - The riming process in the Wilson Ballard microphysics scheme is only
    =   performed where the mixed-phase cloud-fraction exceeds the threshold.
    =
    =Note that pc2_checks performs an independent additional check to remove
    =liquid-cloud fractions below cloud_rounding_tol = 1.0E-12.
    =
    =Also note that cloud_pc2_tol_2 should not exceed cloud_pc2_tol.
!kind=default
ns=namelist/Science/UM Cloud
range=1.0e-12:1.0e-1
sort-key=Panel-A02b
type=real

[namelist:cloud=ez_max]
compulsory=true
description=Maximum entrainment zone depth for bimodal cloud scheme (m)
help=The bimodal cloud scheme (or bimodal initiation in PC2) searches for
    = entrainment zones below sharp inversions. Ez_max sets a limit to how
    = deep entrainment zones can become. The recommended value is 400m.
!kind=default
ns=namelist/Science/UM Cloud
range=300.0:500.0
sort-key=Panel-A10
type=real

[namelist:cloud=ez_subcrit]
compulsory=true
description=Suppress bimodal scheme non-turbulent entrainment zones
help=In the bimodal cloud-scheme
    = (or bimodal-based initiation with PC2),
    = only allow entrainment zones to be diagnosed
    = if they overlap a layer where the Richardson
    = number is sub-critical
    = (so turbulence is possible).
!kind=default
ns=namelist/Science/UM Cloud
sort-key=Panel-A02
type=logical

[namelist:cloud=falliceshear_method]
compulsory=true
description=Select how shear affects falling ice cloud fraction
!enumeration=true
help=Falling ice increases the ice cloud fraction in the layer it falls
    = into. There is the option to include the effects of the further
    = increase in the grid-box cloud fraction due to the lateral
    = displacement as the ice falls because of the vertical shear of
    = the horizontal wind. Either:
    = a) the effects of shear can be ignored,
    = b) a globally constant shear (not calculated from the actual wind)
    =    can be assumed or
    = c) the effects of shear are considered and the shear is calculated
    =    from the model wind.
    =
    =When not using the globally constant value an additional ice cloud
    = fraction source term is used to represent the lateral spreading out
    = of ice cloud fraction while maintaining the same grid-box mean
    = ice water content.
ns=namelist/Science/UM Cloud
sort-key=Panel-A04
trigger=namelist:cloud=cff_spread_rate: 'real'
value-titles=Assume a globally constant shear,
            =Use shear derived from model winds
values='constant','real'

[namelist:cloud=filter_optical_depth]
compulsory=true
description=Apply optical depth filter for cloud diagnostics.
help=If false: outputs the derived cloud diagnostics without any processing.
    =If true:  makes a simple estimate of the ice optical depth in each layer
    =          and ignores optically thin layers when calculating derived
    =          cloud diagnostics.
!kind=default
ns=namelist/Science/UM Cloud
sort-key=Panel-A11
trigger=namelist:cloud=opt_depth_thresh: .true.
type=logical

[namelist:cloud=ice_width]
compulsory=true
description=Width of vapour distribution in liquid-free part of gridbox
help=Ice width specifies the ice content (in terms of a fraction of
    = qsat_liq) that corresponds to a factor of two reduction in the
    = width of the vapour distribution in the liquid-free part of the
    = gridbox. This is only available if a subgrid partitioning of
    = out-of-liquid-cloud water vapor is requested (subgrid_qv=true).
!kind=default
ns=namelist/Science/UM Cloud
range=0.0:1.0
sort-key=Panel-A05a
type=real

[namelist:cloud=mphys_erosion]
compulsory=true
description=Include PC2 erosion as a microphysical term
help=If true:  PC2 erosion is included with the microphysics code
    =If false: PC2 erosion is included with the convection code
!kind=default
ns=namelist/Science/UM Cloud
sort-key=Panel-A09
type=logical

[namelist:cloud=opt_depth_thresh]
compulsory=true
description=Cloud diagnostics optical depth threshold.
help=Amount of ice optical depth below which cloud cover in
    = that layer is ignored when using filter_optical_depth.
!kind=default
ns=namelist/Science/UM Cloud
range=0.0:10.0
sort-key=Panel-A11a
type=real

[namelist:cloud=pc2_init_logic]
compulsory=true
description=Options for where to allow PC2 initiation to operate
!enumeration=true
help=(1) Original logic;
    = Tests are performed to check whether the cloud cover is 0 or 1
    = (but if it is below zero degree C we check for cloud cover less
    = than 0.05 or greater than 1).
    = Tests on being above the LCL when considering initiating away from 0 are
    = also done early on, confusing the logic somewhat.
    = Also the logic prevents PC2 initiating cloud above a convective
    = boundary layer (because of assumption that there is a convection
    = scheme in use that will detrain cloud and create cloud that way instead).
    = This is an issue in a convection-permitting model where there is no
    = convection scheme to create that cloud via detrainment.
    =
    =(3) Much simpler logic that should yield smoother behaviour;
    = The diagnostic cloud scheme calculations (Smith or Bimodal)
    = are performed at any grid-point where they are expected to yield
    = nonzero liquid water content, regardless of the existing cloud fraction.
    = The diagnosed qcl is then taken as a minimum limit applied
    = to the PC2 prognostic qcl.  Cloud fraction is adjusted towards the
    = diagnostic scheme value in proportion to the fractional increase
    = of qcl by initiation (or the fractional increase of saturation deficit
    = at points which are grid-mean total-water supersaturated).
ns=namelist/Science/UM Cloud
sort-key=Panel-A02b
value-titles=Original,Smooth
values='original','smooth'

[namelist:cloud=pc2ini]
compulsory=true
description=Method for doing PC2 initiation
!enumeration=true
help=Smith-like initiation as described in Wilson et al (2008). When cloud
    = fraction is 0 or 1, cloud will be generated or removed based on a
    = triangular subgrid PDF with a width based on the RHcrit profile.
    =
    =Bimodal scheme: call the bimodal cloud scheme when cloud fraction is 0
    = or 1 to determine whether cloud should be initiated or removed based
    = on a bimodal Gaussian subgrid PDF with variances determined from the
    = turbulent properties as in Furtado et al. (2016).
ns=namelist/Science/UM Cloud
sort-key=Panel-A02a
value-titles=Smith,Bimodal
values='smith','bimodal'

[namelist:cloud=rh_crit]
!bounds=namelist:extrusion=number_of_layers
compulsory=true
description=Critical relative humidity
fail-if=len(this) != namelist:extrusion=number_of_layers ;
help=The critical relative humidity is used in the cloud scheme to define
    = the ratio at which cloud starts to form. Values may vary depending on
    = the configuration. Please refer to standard jobs for current
    = recommended settings.
    =
    = The number of values must match the number of levels in the model.
    =
!kind=default
length=:
ns=namelist/Science/UM Cloud
range=0.0:1.0
sort-key=Panel-A03
type=real

[namelist:cloud=rh_crit_opt]
compulsory=true
description=RHCrit parametrization method
!enumeration=true
help=If no parametrization is selected,
    =the values in the table below
    = are used.
    =
    =The boundary layer TKE based method predicts the sub-grid
    = variability based on the gradients,
    =eddy diffusivities and
    = TKE predicted by the boundary layer scheme. It does still
    = make use of the table values in the microphysics code for
    = parametrizing the RH of the clear sky portion of the grid-box.
ns=namelist/Science/UM Cloud
sort-key=Panel-A02
value-titles=No parametrization,
            =Boundary layer TKE based method
values='namelist','tke'

[namelist:cloud=scheme]
compulsory=true
description=Cloud scheme
!enumeration=true
help=Choice of UM cloud scheme to use
    =
    = Smith scheme (1990):
    = Uses the diagnostic cloud fraction and condensate variables,
    = based on a symmetric triangualar PDF of subgrid variability.
    =
    = Bimodal scheme (Van Weverberg et al 2021)
    = Uses the diagnostic cloud fraction and condensate variables,
    = based on a bimodal PDF of sugrid variability.
    =
    = PC2 scheme (Wilson et al 2008):
    = Uses the prognostic cloud and prognostic condensate scheme.
    =
    = Note: Disabling the cloud scheme will result in no updates to
    =       the cloud fraction or water content from the cloud scheme.
    =       Micro-physics updates to cloud are unaffected by this
    =       setting.
    =
ns=namelist/Science/UM Cloud
sort-key=Panel-A01
trigger=namelist:cloud=mphys_erosion: 'pc2' ;
       =namelist:cloud=ez_max: 'pc2', 'bimodal' ;
       =namelist:external_forcing=pc2_force_response: 'pc2';
value-titles=Smith, PC2, Bimodal
values='smith', 'pc2', 'bimodal'

[namelist:cloud=subgrid_qv]
compulsory=true
description=Calculate a partitioning of water vapor outside of liquid cloud
help=Setting this option to true partitions the out-of-liquid-cloud water vapor
    =in each gridbox between clear-sky and sublimating and depositing ice-cloud
    =regions. If this is turned off then qv is the same throughout the
    =clear-sky and ice-cloud parts of each gridbox. Which means that the ice
    =is either entirely sublimating of entirely growing,
    =depending on the value of
    =the in-ice-cloud relative humidity.
!kind=default
ns=namelist/Science/UM Cloud
sort-key=Panel-A05
trigger=namelist:cloud=ice_width: .true.
type=logical

[namelist:cloud=two_d_fsd_factor]
compulsory=true
description=Factor to convert 1D FSD for straight line to 2D value
help=Current parametrizations of FSD (fractional standard deviation,
    =a measure
    =of subgrid variability) of cloud water content used in radiation and
    =microphysics schemes are based on observations taken in a 1D line. For the
    =UM we require the FSD for a 2D gridbox,
    =which is generally larger. We
    =account for this difference by multiplying the 1D fsd by this value.
!kind=default
range=1:2
sort-key=Panel-A08b
type=real

[namelist:cloud=use_fsd_eff_res]
compulsory=true
description=Whether to use a hardwired effective resolution in fractional standard deviation (FSD) scheme
help=If true:  use the FSD equations (from Boutle et al (2014) or Hill et al (2015))
    =          with a fixed grid-size representative of N96/C48.
    =If false: use the FSD equations (from Boutle et al (2014) or Hill et al (2015))
    =          with an estimate of the grid-size calculated from the grid.
!kind=default
ns=namelist/Science/UM Cloud
sort-key=Panel-A08a
type=logical
